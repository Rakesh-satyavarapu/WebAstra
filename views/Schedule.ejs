<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book a Session</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/styles.css">
    <style>
        body { background-color: #f5f5f5; }
        .navbar { background-color: #563dff; }
        .calendar-container, .session-details {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
        }
        .day-box {
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            min-width: 80px;
            cursor: pointer;
        }
        .day-box:hover { background: #eef2ff; }
        .selected { background: #563dff !important; color: white !important; }
        .time-slot { cursor: pointer; padding: 8px; border-radius: 5px; background: #eef2ff; }
        .time-slot:hover, .selected-slot { background: #563dff !important; color: white !important; }
    </style>
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="#">MentorConnect</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="/find-mentor">Find Mentors</a></li>
                    <li class="nav-item"><a class="nav-link active" href="/sessions">Sessions</a></li>
                    <li class="nav-item"><a class="nav-link" href="/messages">Messages</a></li>
                    <li class="nav-item"><a class="nav-link" href="/profile">ðŸ‘¤ <%= user.username %></a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-5">
        <h2 class="text-center fw-bold">Book a Session with <%= mentor.firstname %> <%= mentor.lastname %></h2>
        <p class="text-center text-muted">Select a time slot that works for you</p>

        <div class="row mt-4">
            <!-- Calendar Section -->
            <div class="col-md-8">
                <div class="calendar-container p-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <button class="btn btn-outline-secondary" id="prev-month">â€¹</button>
                        <h5 id="month-year">February 2025</h5>
                        <button class="btn btn-outline-secondary" id="next-month">â€º</button>
                    </div>

                    <div class="d-flex justify-content-between text-center">
                        <% let days = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"]; %>
                        <% let availableSlots = { "28": ["10:00 AM", "2:00 PM"], "30": ["11:00 AM"] }; %>
                        <% let startDate = 24, endDate = 28; %>

                        <% for (let i = startDate; i <= endDate; i++) { %>
                            <div class="day-box border <%= availableSlots[i] ? 'bg-light' : 'text-muted' %>" 
                                 data-date="<%= i %>">
                                <div><strong><%= days[(i - startDate) % 7] %></strong></div>
                                <div class="<%= availableSlots[i] ? 'fw-bold' : 'text-muted' %>">
                                    <%= i %>
                                </div>
                                <div class="small">
                                    <%= availableSlots[i] ? availableSlots[i].length + " slots" : "No slots" %>
                                </div>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>

            <!-- Session Details -->
            <div class="col-md-4">
                <div class="session-details text-center">
                    <h5>Session Details</h5>
                    <p class="text-muted">Select a date and time slot</p>
                    <div id="selected-slot" class="fw-bold text-primary"></div>
                    
                    <div id="time-slots" class="mt-3"></div>

                    <button class="btn btn-primary w-100 mt-3 d-none" id="book-btn">Confirm Booking</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const days = document.querySelectorAll(".day-box");
            const timeSlotsContainer = document.getElementById("time-slots");
            const sessionDetails = document.getElementById("selected-slot");
            const bookBtn = document.getElementById("book-btn");

            let selectedDate = null;
            let selectedTime = null;

            days.forEach(day => {
                day.addEventListener("click", function () {
                    days.forEach(d => d.classList.remove("selected"));
                    this.classList.add("selected");

                    selectedDate = this.getAttribute("data-date");
                    const availableSlots = <%- JSON.stringify(availableSlots) %>;

                    timeSlotsContainer.innerHTML = "";
                    sessionDetails.innerHTML = `Selected: ${selectedDate} Feb 2025`;
                    
                    if (availableSlots[selectedDate]) {
                        availableSlots[selectedDate].forEach(time => {
                            let timeSlot = document.createElement("div");
                            timeSlot.classList.add("time-slot", "p-2", "mt-2");
                            timeSlot.innerText = time;
                            timeSlot.addEventListener("click", function () {
                                document.querySelectorAll(".time-slot").forEach(t => t.classList.remove("selected-slot"));
                                timeSlot.classList.add("selected-slot");
                                selectedTime = time;
                                sessionDetails.innerHTML = `Selected: ${selectedDate} Feb 2025 at <b>${time}</b>`;
                                bookBtn.classList.remove("d-none");
                            });
                            timeSlotsContainer.appendChild(timeSlot);
                        });
                    } else {
                        timeSlotsContainer.innerHTML = "<p class='text-muted'>No slots available.</p>";
                        bookBtn.classList.add("d-none");
                    }
                });
            });

            bookBtn.addEventListener("click", function () {
                if (selectedDate && selectedTime) {
                    fetch("/book-session", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ mentorId: "<%= mentor._id %>", dateTime: `2025-02-${selectedDate} ${selectedTime}` })
                    }).then(response => response.json()).then(data => {
                        alert(data.message || "Session booked successfully!");
                    });
                }
            });
        });
    </script>

</body>
</html>
